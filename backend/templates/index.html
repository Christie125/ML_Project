<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/index.css">
    <title>Exam Score Predictor</title>
</head>

<body>
    <!-- This is a landmark element, which helps with accessibility -->
    <header>
        <h1>Exam Score Predictor</h1>
        <h2>Enter your details below to receive an AI-powered prediction of your exam score.</h2>
    </header>
    <!-- This is also a landmark element, which helps with accessibility -->
    <main>
        <!-- This form collects the data from the user, which will then go into the model input -->
        <form id="prediction-form">
            <label for="age">Your age (in years):</label>
            <br>
            <input type="number" id="age" name="age" required aria-required="true"><br>

            <label for="study_hours">How many hours have you studied for this exam?</label>
            <br>
            <input type="number" id="study_hours" name="study_hours" required aria-required="true"><br>

            <label for="sleep_hours">How many hours of sleep do you get a night?</label>
            <br>
            <input type="number" id="sleep_hours" name="sleep_hours" required aria-required="true"><br>
            <label for="sleep_quality">How would you rate your sleep quality (1(poor)-3(good))?</label>
            <br>
            <input type="number" id="sleep_quality" name="sleep_quality" required aria-required="true"><br>

            <label for="class_attendance">Your class attendance (%):</label>
            <br>
            <input type="number" id="class_attendance" name="class_attendance" required aria-required="true"><br>

            <label for="exam_difficulty">How difficult is the exam (1(easy)-3(hard))?</label>
            <br>
            <input type="number" id="exam_difficulty" name="exam_difficulty" required aria-required="true"><br>
            <label for="facility_rating">How good are your school's facilities (1(poor)-3(good))?</label>
            <br>
            <input type="number" id="facility_rating" name="facility_rating" required><br>

            <button type="submit">Predict Exam Score</button>
        </form>

        <!--Where the results will later show-->
        <div id="result"></div>
        <a href="/" role="button">Try Again</a>
    </main>

    <!-- This collects the form data, converts it to JSON and sends it to the backend -->
    <script>
        // This listens for the form submission, ready to act when the user clicks submit
        document.getElementById('prediction-form').addEventListener('submit', async function (form) {
            // This prevent the default form submission behavior, which stops the page from reloading
            form.preventDefault();

            // This actually collects the form data and makes it into a JSON array
            // ParseFloat is used to convert string inputs to numbers, which the model requires
            const formData = {
                age: parseFloat(document.getElementById('age').value),
                study_hours: parseFloat(document.getElementById('study_hours').value),
                sleep_hours: parseFloat(document.getElementById('sleep_hours').value),
                sleep_quality: parseFloat(document.getElementById('sleep_quality').value),
                class_attendance: parseFloat(document.getElementById('class_attendance').value),
                exam_difficulty: parseFloat(document.getElementById('exam_difficulty').value),
                facility_rating: parseFloat(document.getElementById('facility_rating').value)
            };

            //checking that this works in the console
            console.log('JSON Data:', JSON.stringify(formData));

            // Send to Flask backend
            try {
                const response = await fetch('/score', { //the api endpoint, see api.py
                    method: 'POST', //posting the data
                    headers: {
                        'Content-Type': 'application/json' //specifying json data so I can fetch it later
                    },
                    body: JSON.stringify(formData) //sending the actual data as the body of the request
                });
                console.log('Awaiting response from backend', response);

                if (response.ok) {
                    const data = await response.json(); // parsing the json response
                    console.log('Response Data:', data);
                    document.getElementById('prediction-form').style.display = 'none';
                    document.getElementById('again-button').style.visibility = 'visible';
                    document.getElementById('result').style.visibility = 'visible';
                    document.getElementById('result').innerText = `Predicted Exam Score: ${data.predicted_score.toFixed(2)}%`; //displays the result to 2 decimal places
                } else {
                    console.error('Error response from server:', response.statusText);
                    document.getElementById('result').innerText = 'Error predicting exam score. Please try again.';
                }

            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>

</html>